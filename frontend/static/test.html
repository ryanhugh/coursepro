<html>
	<head>
		<script>
		
		
		var box;
		window.onload = function(){

		}
		
		
		//this function is already in the code, dont change it
		function request(config,callback) {
			
		  if (!localStorage.userId) {
		      //new user, yay!
		      localStorage.userId = Math.random()+''
		  }
		  
		  config.body.userId = localStorage.userId;
			
			var xmlhttp=new XMLHttpRequest();
			xmlhttp.onreadystatechange=function()
			{
				if (xmlhttp.readyState!=4) {
					return;
				}
				if (xmlhttp.status!=200) {
					var err;
					if (xmlhttp.statusText) {
						err = xmlhttp.statusText;
					}
					else if (xmlhttp.response) {
						err = xmlhttp.response;
					}
					else {
						err = 'unknown ajax error'
					}
		
					console.log('error, bad code recievied',xmlhttp.status,err)
					return callback(err)
				}
		
				var response = JSON.parse(xmlhttp.response)
		
				callback(null,response);
				
			}.bind(this);
		
		
			xmlhttp.open('POST',config.url,true);
			xmlhttp.setRequestHeader("Content-type","application/json");
			xmlhttp.send(JSON.stringify(config.body));
		}
		
		// http://stackoverflow.com/a/46181/11236
		// this is also done client side
		function validateEmail(email) {
			if (!email) {
				return false;
			};
		
			var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			if (!re.test(email)) {
				console.log('email failed regex',email)
				return false;
			}
			
			return true;
		}

		
		
		function onEmailSubmit (email) {

			var box=document.getElementById('emailBoxId');
			var email = box.value.trim();
			
			if (!validateEmail(email)) {
				console.log(email,'is not an email address!');
				
				
				//show some warning in the html
				
				return;
			}
		
			
			console.log('email submitted:',email);
			request({
				url:'/registerForEmails',
				body:{
					email:email
				}
			},function (err,responce) {
				if (err) {
					
					//server error, probably will not happen but can be a bunch of different stuff
					console.log(err);
					
					//display some warning in the html
					// sometimes the returned err is not pretty, so just say "A server error occured :/" or something
					return;
				}
				
				else if (responce.error) {
					
					//some other errors are possible - same thing as above
					console.log(responce.error)
					return;
				}
				
				else {
					console.log('it worked!')
					document.body.innerHTML+='<br>subscribe successful!'
				}
				
				
			})
		}
		
		
		function onEmailUnsubscribe (email) {
			
			var box=document.getElementById('emailBoxId');
			var email = box.value.trim();
			
			if (!validateEmail(email)) {
				console.log(email,'is not an email address!');
				
				
				//show some warning in the html
				
				return;
			}
		
			
			console.log('email submitted:',email);
			request({
				url:'/unsubscribe',
				body:{
					email:email
				}
			},function (err,responce) {
				if (err) {
					
					//server error, probably will not happen but can be a bunch of different stuff
					console.log(err);
					
					//display some warning in the html
					// sometimes the returned err is not pretty, so just say "A server error occured :/" or something
					return;
				}
				
				else if (responce.error) {
					
					//some other errors are possible - same thing as above
					console.log(responce.error)
					return;
				}
				
				else {
					console.log('it worked!')
					document.body.innerHTML+='<br>unsubscribe successful!'
				}
				
				
			})
		}
		</script>
	</head>
	
	
	
	
	
	
	<body>
		<!--<form onSubmit="onEmailSubmit()">-->
		  Submit your email!:<br>
		  <input type="text" name="email" id="emailBoxId">
		  <br>
		  <input type="submit" value="Subscribe!" onclick="onEmailSubmit()">
		  <input type="submit" value="Unsubscribe" onclick="onEmailUnsubscribe()">
		<!--</form>-->
	</body>
</html>